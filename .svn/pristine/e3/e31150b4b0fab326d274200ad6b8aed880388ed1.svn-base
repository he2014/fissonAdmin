var util = window['util'] = {
    'Storage': {
        hname: location.hostname ? location.hostname : 'localStatus',
        isLocalStorage: window.localStorage ? true : false,
        dataDom: null,

        initDom: function() { //初始化userData
            if (!this.dataDom) {
                try {
                    this.dataDom = document.createElement_x('input'); //这里使用hidden的input元素
                    this.dataDom.type = 'hidden';
                    this.dataDom.style.display = "none";
                    this.dataDom.addBehavior('#default#userData'); //这是userData的语法
                    document.body.appendChild(this.dataDom);
                    var exDate = new Date();
                    exDate = exDate.getDate() + 30;
                    this.dataDom.expires = exDate.toUTCString(); //设定过期时间
                } catch (ex) {
                    return false;
                }
            }
            return true;
        },
        set: function(key, value) {
            if (this.isLocalStorage) {
                window.localStorage.setItem(key, escape(value));
            } else {
                if (this.initDom()) {
                    this.dataDom.load(this.hname);
                    this.dataDom.setAttribute(key, escape(value));
                    this.dataDom.save(this.hname)
                }
            }
        },
        get: function(key) {
            if (this.isLocalStorage) {
                return unescape(window.localStorage.getItem(key));
            } else {
                if (this.initDom()) {
                    this.dataDom.load(this.hname);
                    return unescape(this.dataDom.getAttribute(key));
                }
            }
        },
        remove: function(key) {
            if (this.isLocalStorage) {
                localStorage.removeItem(key);
            } else {
                if (this.initDom()) {
                    this.dataDom.load(this.hname);
                    this.dataDom.removeAttribute(key);
                    this.dataDom.save(this.hname)
                }
            }
        }
    },

    'queryString': function(key) {
        var result = location.search.match(new RegExp("[\?\&]" + key + "=([^\&]+)", "i"));
        if (result == null || result.length < 1)
            return "";
        return result[1];
    },
    'DateTime': {
        'showtime': function(source) {
            var month = source.getMonth() + 1
            return source.getFullYear() + '-' + (month < 10 ? '0' + month : month) + '-' + (source.getDate() < 10 ? '0' + source.getDate() : source.getDate());
        },

        'fulltime': function(source) {
            var hours = source.getHours(),
                minutes = source.getMinutes(),
                seconds = source.getSeconds();
            return this.showtime(source) + ' ' +
                (hours < 10 ? '0' + hours : hours) +
                ':' + (minutes < 10 ? '0' + minutes : minutes) +
                ':' + (seconds < 10 ? '0' + seconds : seconds);
        }
    },
    'String': {
        'stringFormat': function() {
            if (arguments.length == 0)
                return null;
            var value = arguments[0];
            for (var i = 1, count = arguments.length; i < count; i++) {
                var pattern = new RegExp('\\{' + (i - 1) + '\\}', 'gm');
                value = value.replace(pattern, arguments[i]);
            }
            return value;
        },

        'trim': function(source) {
            return source.replace(/^\s+|\s+$/gi, '');
        },

        'getByteLength': function(source) {
            return String(source).replace(/[^\x00-\xff]/g, "ci").length;
        },

        'subByte': function(source, length, tail) {
            source = String(source);
            tail = tail || '';
            if (length < 0 || this.getByteLength(source) <= length) {
                return source;
            }
            source = source.substr(0, length).replace(/([^\x00-\xff])/g, "\x241 ")
                .substr(0, length)
                .replace(/[^\x00-\xff]$/, "")
                .replace(/([^\x00-\xff]) /g, "\x241");
            return source + tail;
        },

        'xssFilter': function(source) {
            source = source.replace(/</gi, '').replace(/>/gi, '').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            return source;
        }


    },
}
var cookie_util = window['cookie_util'] = new function() {
    this.base_attr = {
        loginKey: "SELF_LOGIN_KEY", //活动专用
        user_msg: "SELF_USER_ID", //活动专用
    };
    this.get_cookie = function(cookie_name) {
        if (!cookie_name || cookie_name == '') {
            return null;
        }
        var reg = new RegExp("(^| )" + cookie_name + "=([^;]*)(;|$)");
        var arr = document.cookie.match(reg);
        if (arr) {
            return unescape(arr[2]);
        } else {
            return null;
        }
    };
    this.add_or_update_cookie = function(cookie_name, cookie_val, time) {
        if (!cookie_name || cookie_name == '') {
            return;
        }
        var cookie_str = cookie_name + "=" + escape(cookie_val) + ";";
        if (time > 0) {
            var date = new Date();
            date.setTime(date.getTime() + time);
            cookie_str += "expires=" + date.toGMTString() + ";";
        }
        cookie_str += "path=/;domain=;";
        document.cookie = cookie_str;
    };
    this.delete_cookie = function(cookie_name) {
        if (!cookie_name || cookie_name == '') {
            return;
        }
        var date = new Date();
        date.setTime(date.getTime() - 10000);
        document.cookie = cookie_name + "=; expires=" + date.toGMTString() + ";path=/;domain=;";
    };
};
