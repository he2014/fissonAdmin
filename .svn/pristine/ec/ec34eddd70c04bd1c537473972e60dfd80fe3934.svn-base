<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" type="text/css" href="../../../static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="../../../lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="../../../static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="../../../static/h-ui.admin/css/style.css" />
    <link rel="stylesheet" href="../../css/page.css">
    <title>管理员列表</title>
    <style type="text/css">
        .int {
            border: 1px solid #ccc;
            height: 30px;
            margin-bottom: 20px;
        }

        .editorPage {
            margin-left: 10px;
            margin-right: 10px;
        }

        .modal-dialog {
            width: 1050px;
        }

        #functionTable {
            border: 1px solid #0094ff;
        }

        #functionTable tr td {
            border-right: 1px solid #0094ff;
            border-bottom: 1px solid #0094ff;
        }

        #functionTable tr td tr td {
            border-right: none;
            border-bottom: 1px solid #0094ff;
        }

        #pageTable {
            border: 1px solid #0094ff;
        }

        #pageTable tr td {
            border-right: none;
            border-right: 1px solid #0094ff;
            border-bottom: 1px solid #0094ff;
        }

        #pageTable tr td tr td {
            border-right: none;
            border-bottom: 1px solid #0094ff;
        }

        table {
            border-collapse: collapse;
            border: none;
        }

        td {
            /* width: 250px; */
            text-align: center;
            vertical-align: middle;
        }

        table tr td table td {
            border: none;
            /* border-bottom: 1px solid #0094ff; */
            height: 29px;
            padding: 0;
        }
    </style>
</head>

<body>
    <nav class="breadcrumb">
        <i class="Hui-iconfont">&#xe62e;</i> 系统管理
        <span class="c-gray en">&gt;</span> 系统角色管理
        <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新">
		<i class="Hui-iconfont">&#xe68f;</i>
	</a>
    </nav>
    <div class="page-container">
        <!-- 查询条件 -->
        <div class="text">
            <input type="text" class="input-text" style="width:250px" placeholder="输入角色名称" id="" name="">
            <button type="submit" class="btn btn-success" id="" name=""><i class="Hui-iconfont">&#xe665;</i> 查询</button>
        </div>
        <!-- 操心按钮 -->
        <div class="cl pd-5 bg-1 bk-gray mt-20">
            <span class="l">
			<a href="javascript:;" class="btn btn-danger radius" id="batchDelete">
				<i class="Hui-iconfont">&#xe6e2;</i> 批量删除
			</a>
			<a href="javascript:;" onclick="admin_add()" class="btn btn-primary radius">
				<i class="Hui-iconfont">&#xe600;</i> 添加角色
			</a>
		</span>
            <table class="table table-border table-bordered table-bg  table-hover">
                <thead>
                    <tr>
                        <th scope="col" colspan="9">角色列表</th>
                    </tr>
                    <tr class="text-c">
                        <th width="25"><input type="checkbox" name="" value=""></th>
                        <th width="150">ID</th>
                        <th width="180">角色名</th>
                        <th width="180">创建时间</th>
                        <th width="400">操作</th>
                    </tr>
                </thead>
                <tbody id="UserList">
                </tbody>
            </table>
            <div id="user_layerPage"></div>
        </div>
        <!-- 添加用户 -->
        <div id="addUser" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content radius">
                    <div class="modal-header">
                        <h3 class="modal-title">添加角色</h3>
                        <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                    </div>
                    <div class="modal-body">
                        <span>角色名：</span><input id="un" class="input-user int" type="text" placeholder="请输入角色名" /><br/>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary add-User" id="SaveBtn">确定</button>
                        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 用户修改 -->
        <div id="editUser" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content radius">
                    <div class="modal-header">
                        <h3 class="modal-title">信息修改</h3>
                        <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                    </div>
                    <div class="modal-body">
                        <span>修改角色名：</span><input id="un" class="input-userName int" type="text" placeholder="请输入新角色名" /><br/>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary edit-User" id="submitNewpwd">确定</button>
                        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 修改页面权限 -->
        <div id="pageEdit" class="modal fade pageEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content radius">
                    <div class="modal-header">
                        <h3 class="modal-title pagePrompt">对话框标题</h3>
                        <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                    </div>
                    <div class="modal-body">
                        <table id="pageTable"></table>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary submitIds">确定</button>
                        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 修改功能权限 -->
        <div id="functionEdit" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content radius">
                    <div class="modal-header">
                        <h3 class="modal-title functionPrompt">对话框标题</h3>
                        <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                    </div>
                    <div class="modal-body">
                        <table id="functionTable"></table>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary">确定</button>
                        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="../../../lib/jquery/1.9.1/jquery.min.js"></script>
        <script type="text/javascript" src="../../../lib/layer/2.4/layer.js"></script>
        <script type="text/javascript" src="../../../static/h-ui/js/H-ui.min.js"></script>
        <script type="text/javascript" src="../../../static/h-ui.admin/js/H-ui.admin.js"></script>
        <!--/_footer 作为公共模版分离出去-->

        <!--请在下方写此页面业务相关的脚本-->
        <script type="text/javascript" src="../../../lib/My97DatePicker/4.8/WdatePicker.js"></script>
        <script type="text/javascript" src="../../../lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="../../../lib/laypage/1.2/laypage.js"></script>
        <script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
        <!-- 常用公共JS-->
        <script type="text/javascript" src="../../js/util.js"></script>
        <!-- 模板 -->
        <script type="text/javascript" src="../../js/component.js"></script>
        <!--用户表格-->
        <script type="text/javascript" src="../../js/system/role.js"></script>
        <!-- <script src="../../js/system/chen.js"></script> -->
        <script type="text/javascript">
            /*用户-增加*/
            function admin_add() {
                $("#addUser").modal("show")
                //验证新增用户
                $(".add-User").unbind('click').click(function(event) {
                    var un = $(".input-user").val();
                    var regex = new RegExp(/^(?![^a-zA-Z]+$)(?!\D+$)/);
                    if (!un) {
                        $.Huimodalalert('角色名不能为空！', 1500)
                    }
                    if (un) {
                        var data = {
                            n: un
                        }
                        postAjax("role/add", data, function(msg) {
                            if (msg.code == 0 && msg.dataInfo > 0) {
                                $.Huimodalalert('新角色保存成功！', 1500)
                                $("#addUser").modal("hide");
                                $(".input-user").val("");
                                user_taable.getUserList(1);

                            }
                        })
                    }
                });
            }
            // 修改功能
            var stringFormat = util.String.stringFormat;
            var functiontable = {
                init: function() {
                    this.getFunction();
                },
                getFunction: function() {
                    var _this = this;
                    // $("#functionTable").html(" ");
                    $("#functionTable").html(
                        "<tr> " +
                        "<td>顶部菜单</td>" +
                        "<td>左侧菜单</td>" +
                        "<td>资源</td>" +
                        "<td>是否有进入权限</td>" +
                        "</tr>"
                    );

                    var htmlTemplate = {
                        td: '<td style="height:{0}px" id="{1}" pid="{2}">{3}</td>',
                        trtd: ' <tr> <td style="height: {0}px;" id="{1}" pid="{2}">{3}</td></tr>',
                        lasttrtd: ' <tr> <td id="{0}" pid="{1}">{2}</td></tr>',
                        lasttrtdNotWithBottun: ' <tr> <td id="{1}" pid="{2} style="height: 30px; border-bottom: none;"">{3}</td></tr>',
                        trtdNotWithBottum: ' <tr> <td style="height: {0}px;border-bottom: none;" id="{1}" pid="{2}" class="mybutton">{3}</td></tr>',
                        tdtable: '<td><table>{0}</table></td>',
                        tdconst: '<td> <table><tr><td style="height: 30px; border-bottom: none;">没有资源</td></tr></table>',
                        symbol: '<td class="td-manage"><form name="from1" ><input type="radio" name="yes" / value="0"><label>是</label><input name="no" type="radio" value="1" / ><label>否</label></form></td>',
                    }
                    
                    getAjax("privilege/role/function/1", {}, function(data) {
                        //顶部菜单
                        data.dataInfo.forEach(function(t) {
                            var template = "<tr>";
                            template += "<td id='" + t.id + "' pid='" + t.pId + "'>" + t.name + "</td>";
                            var td1 = "";
                            var td2 = "";
                            var td3 = "";
                            if (t.childs && t.childs.length > 0) {
                                //左侧菜单
                                t.childs.forEach(function(value1, index1, array1) {
                                    var functionSize = getFunctionSize(value1);
                                    if (index1 == array1.length - 1) {
                                        td1 += stringFormat(htmlTemplate.trtdNotWithBottum, 30 * functionSize, value1.id, value1.pId, value1.name);
                                    } else {
                                        td1 += stringFormat(htmlTemplate.trtd, 30 * functionSize, value1.id, value1.pId, value1.name);
                                    }
                                    //资源
                                    if (value1.childs && value1.childs.length > 0) {
                                        value1.childs.forEach(function(value2, index2, array2) {
                                            var functionSize2 = getFunctionSize(value2);
                                            if (index1 == array1.length - 1 && index2 == array2.length - 1) {
                                                td2 += stringFormat(htmlTemplate.trtdNotWithBottum, 30 * functionSize2, value2.id, value2.pId, value2.name);
                                            } else {
                                                td2 += stringFormat(htmlTemplate.trtd, 30 * functionSize2, value2.id, value2.pId, value2.name);

                                            }
                                            //         // 功能
                                            if (value2.functionInfoBeans && value2.functionInfoBeans.length > 0) {
                                                value2.functionInfoBeans.forEach(function(value3, index3, array3) {
                                                    if (index2 == array2.length - 1 && index3 == array3.length - 1) {
                                                        console.info(value3.functionName);
                                                        td3 += stringFormat(htmlTemplate.lasttrtdNotWithBottun, value3.functionId, value3.resourceId, value3.functionName + htmlTemplate.symbol);
                                                    } else {
                                                        // console.info(value3.functionName);
                                                        td3 += stringFormat(htmlTemplate.lasttrtd, value3.functionId, value3.resourceId, value3.functionName + htmlTemplate.symbol);
                                                    }
                                                });

                                            } else {
                                                if (index1 == array1.length - 1 && index2 == array2.length - 1) {
                                                    td3 += "<tr><td style=\"height: 30px; border-bottom: none;\">没有资源</td></tr>";
                                                } else {
                                                    td3 += "<tr><td style=\"height: 30px; \">没有资源</td></tr>";
                                                }
                                            }
                                        });
                                    } else {
                                        if (index1 == array1.length - 1) {
                                            td2 += "<tr><td style=\"height: 30px; border-bottom: none;\">没有资源</td></tr>";
                                            td3 += "<tr><td style=\"height: 30px; border-bottom: none;\">没有资源</td></tr>";
                                        } else {
                                            td2 += "<tr><td style=\"height: 30px; \">没有资源</td></tr>";
                                            td3 += "<tr><td style=\"height: 30px; \">没有资源</td></tr>";
                                        }
                                    }

                                });
                            } else {
                                template +=
                                    '<td> <table><tr><td style="height: 30px; border-bottom: none;">没有资源</td></tr></table>' +
                                    '<td> <table><tr><td style="height: 30px; border-bottom: none;">没有资源</td></tr></table>' +
                                    '<td> <table><tr><td style="height: 30px; border-bottom: none;">没有资源</td></tr></table>';
                            }
                            template += (
                                (td1 == "" ? "" : stringFormat(htmlTemplate.tdtable, td1)) +
                                (td2 == "" ? "" : stringFormat(htmlTemplate.tdtable, td2)) +
                                (td3 == "" ? "" : stringFormat(htmlTemplate.tdtable, td3)) +
                                "</tr>");
                            $("#functionTable").append(template);

                        });
                     _this.binds();   
                    });
                },
                binds: function() {
                    var _this = this;
                    // 
                    $('input[name="yes"]').on('click',function(){
                        alert($('input[name="yes"]').val())
                    })
                    // $('input[name="no"]').on('click',function(){
                    //     alert($('input[name="no"]').val())
                    // })
                    
                //     $("#functionTable td").on("click", "div", function(e) {
                //         var target = e.target;
                //         var id = $(target).attr("id");
                //         var reId = $(target).attr("dataId");
                //         // console.log(id).split("_")
                //         if (id) {
                //             if (id.split("_")[0] == 'fun') {
                //                 var ids = id.split("_")[1]
                //                 layer.open({
                //                     content: template.btn,
                //                     // success: function(layero, index){
                //                     //   console.log(layero, index);
                //                     // }
                //                 });
                //                 $(".layui-layer-btn a").css("display", 'none')
                //                 setTimeout(function() {
                //                     $("#functonBtn_add").on("click", function() {

                //                     })
                //                     $("#functonBtn_edit").on("click", function() {

                //                     })
                //                     $("#functonBtn_delete").on("click", function() {
                //                         layer.confirm('您确定删除吗？', {
                //                             btn: ['确定', '取消'] //按钮
                //                         }, function() {
                //                             postAjax("function/del", {
                //                                 id: ids
                //                             }, function(data) {
                //                                 if (data.code == 0) {
                //                                     layer.msg("删除成功");
                //                                     _this.getFunction();
                //                                 } else {
                //                                     return false;
                //                                 }
                //                             })
                //                         }, function() {
                //                             // return false;
                //                         });
                //                     })
                //                 }, 300)
                //             }
                //         }
                //     })
                 }
            }

            function getFunctionSize(e) {
                if (e == null) {
                    return 0;
                }
                // 如果是菜单
                if (e.isMenu == 0) {
                    var i = 0;
                    if (e.childs && e.childs.length > 0) {
                        for (temp in e.childs) {
                            i += getFunctionSize(e.childs[temp]);
                        }
                        return i;
                    } else {
                        return 0;
                    }
                } else {
                    return e.functionInfoBeans && e.functionInfoBeans.length > 0 ? e.functionInfoBeans.length : 1;
                }
            }

            functiontable.init();



            // 修改页面权限
           

            // }

           

           // pagetable.init();
        </script>
</body>

</html>
